var iKorektor=new function(){var e,t,r,n='<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ikorektor/plugin@2/css/style.min.css">',i={type:"small",location:"bottom",color:"#093",inputs:!0,prompt:!1,parags:0,profanity:0,gateway:!0,version:null,csshash:null};this.init=function(t){"object"==typeof iKorektorConf&&(i=Object.assign(i,iKorektorConf)),i.version&&i.csshash&&(n=n.replace("@2","@"+i.version).replace(">",` integrity="${i.csshash}" crossorigin="anonymous">`)),t&&document.addEventListener("click",a);var r=document.activeElement;r&&s(r)&&(e=r,c())};var a=function(n){var a=n.target;if(a)if(s(a)){var l=document.getElementById("ik-do");l&&l.classList.contains("ik-spin")||(e!==a&&(r=null),e=a,c(l))}else if("li"===a.tagName.toLowerCase())a.className.indexOf("ik-")>=0&&!a.classList.contains("ik-dis")&&S(a);else if(i.prompt&&"submit"===a.type)o(n);else switch(a.id){case"ik-do":d();break;case"ik-accept":B(a.parentNode);break;case"ik-cancel":a.parentNode.style.display="none",document.getElementById("ik-do").disabled=!1,e.focus();break;case"ik-report":case"ik-target":n.preventDefault();var p="ik-target"===a.id?e.value:t;window.open(a.href+(p?"="+encodeURIComponent(p):""));break;default:u()}},o=function(t){var r=document.getElementsByTagName("textarea");if(r){e=null;for(var n=0;n<r.length;n++)if(r[n].value.length>2){e=r[n];break}e&&(i.prompt=!1,confirm("Czy chcesz wykonać autokorektę tekstu przed wysłaniem?")&&(t.preventDefault(),c(),d(),e.scrollIntoView({behavior:"smooth"})))}},s=function(e){var t=e.tagName.toLowerCase();return"textarea"===t||i.inputs&&"input"===t&&"text"===e.type},c=function(t){var r=t||document.getElementById("ik-do");if(!r)return l();r.style.display="block";var n=_(e),a="top"===i.location?n.top+5:n.top+e.offsetHeight-35,o=window.innerWidth-(n.left+e.offsetWidth);r.style.top=a.toFixed(2)+"px",r.style.right=o.toFixed(2)+"px",r.disabled=!1;var s=document.getElementById("ik-inf");s&&(s.style.display="none")},l=function(){document.body.insertAdjacentHTML("beforeend",M("","ik-do")+n);var e=document.getElementById("ik-do");e.classList.toggle("sml","small"===i.type),e.style.setProperty("background-color",i.color),e.style.setProperty("--bgcolor",i.color),c(e)},u=function(){var e=document.getElementById("ik-do");if(e&&!e.disabled&&D(e)){var t=document.getElementById("ik-inf");t&&D(t)||(e.style.display="none")}},d=function(){var e=g();if(e.length<3)return f("Tekst jest zbyt krótki.",!0);var t=document.getElementById("ik-do");t.disabled=!0,t.classList.add("ik-spin"),p(e)},p=function(n){fetch("https://api.ikorektor.pl",{method:"POST",body:k(n),credentials:"include"}).then(e=>{if(e.ok)return e.json();throw Error(e.statusText)}).then(a=>{if(a.hasOwnProperty("error"))f(y(a,n.length),!0);else{t=n,r=e.value,i.prompt=!1;var o=document.createElement("p");o.textContent=a.text,a.text=o.innerHTML,f(h(a),!1)}}).catch(e=>{console.log(e),f(y({},null),!0)})},k=function(e){var t=new FormData;return t.append("key","O"),t.append("text",e),t.append("app","plugin"),i.parags&&t.append("parags",i.parags),i.profanity&&t.append("profanity",i.profanity),i.gateway||t.append("gateway",0),t},g=function(){var t=e.selectionStart,r=e.selectionEnd;return t===r?e.value.trim():e.value.slice(t,r)},f=function(e,t){var r=document.getElementById("ik-inf");if(!r)return m(e,t);var n=document.getElementById("ik-do"),i=r.querySelector("div");n.disabled=!t,n.classList.remove("ik-spin"),r.style.top=parseInt(n.style.top,10)+n.offsetHeight+9+"px",r.style.right=n.style.right,r.style.display="block",i.innerHTML=e,i.classList.toggle("ik-corr-err",t),r.querySelector("#ik-accept").disabled=t},m=function(e,t){document.body.insertAdjacentHTML("beforeend",`<div id="ik-inf"><div></div>${M("Anuluj","ik-cancel")+M("Akceptuj i zamień","ik-accept")}\n<p>${K("pluginy","Plugin autokorekty © iKorektor")+"•"+K("info","Informacje")+"•"+K("kontakt?report","Zgłoś błąd korekty","ik-report")}</p></div>`),v(),f(e,t)},v=function(){document.addEventListener("keydown",t=>{var n=t.target;13===t.keyCode&&n&&n.classList.contains("ik-corr")?T(n):90===t.keyCode&&t.ctrlKey&&r&&(e.value=r,r=null)}),document.addEventListener("focusout",e=>{var t=e.target;t&&t.classList.contains("ik-corr")&&T(t)})},y=function(e,t){switch(e.error){case"TXT_LEN":return`Tekst jest zbyt długi (${t} na ${e.txt_limit} dozwolonych znaków w jednej korekcie).`;case"CHARS_LMT":return`Pozostało Ci ${e.chars_left} znaków z dobowego limitu, tekst ma ${t} znaków.`;case"CALLS_LMT":return"Osiągnięto limit korekt na minutę. Spróbuj ponownie za chwilę.";case"SITE_LMT":return"Dobowy limit użycia pluginu został osiągnięty. Tekst możesz poprawić na stronie "+K("?txt","iKorektor.pl","ik-target")}return"Coś poszło nie tak. Spróbuj ponownie za chwilę lub "+K("info","dowiedz się więcej")},h=function(e){var t=e.text,r=t.match(/[a-zA-ZŻŹŁŚĆÓąęćłóśńżź]{2,}/g),n=t.match(/.{4}[,.)”–?]|[(„].{4}/g),i=[];return n&&(t=b(t,n)),e.hasOwnProperty("sugg")&&(t=L(t,e.sugg,i)),r&&(t=w(t,r)),e.hasOwnProperty("succ")&&(t=x(t,e.succ,i)),e.hasOwnProperty("fail")&&(t=$(t,e.fail)),t},b=function(e,r){for(var n=0;n<r.length;n++)-1===t.indexOf(r[n])&&-1===t.indexOf(R(r[n].toLowerCase()))&&(e=e.replace(r[n],r[n].replace(/([,.()„”–?])/g,`<span class="ik-mark"><span data-corr="$1" class="ik-corr ik-corr-succ">$1</span><ul>${z()}</ul></span>`)));return e},L=function(e,t,r){for(var n=0;n<t.length;n++){var i=t[n],a=i.length-1,o=i[a],s=o.toLowerCase(),c="";(i=i.slice(0,a)).indexOf(s)<0&&i.indexOf(o.substr(0,1).toUpperCase()+s.substr(1))<0?c="2":i=E(i,s);var l=i.length?`<li class="ik-sugg">${i.join('</li><li class="ik-sugg">')}</li>`:"";e=e.replace(C(o,"i"),`$1<span class="ik-mark"><span data-corr="$2" class="ik-corr ik-corr-sugg${c}">$2</span><ul>${l+z()}</ul></span>`),r[n]=o}return e},w=function(e,r){for(var n=0;n<r.length;n++){var i=r[n],a=C(i);t.match(a)||(e=(e=e.replace(a,`$1<span class="ik-mark"><span data-corr="$2" class="ik-corr ik-corr-succ">$2</span><ul>${z()}</ul></span>`)).replace(new RegExp(`ik-corr-sugg(2?)(?=">${i})`,"g"),"ik-corr-sugg$1-succ"))}return e},x=function(e,t,r){for(var n=0;n<t.length;n++){var i=t[n][0],a=t[n][1];e=r.indexOf(a)>=0?e.replace(new RegExp(`ik-corr-sugg(?=">${i})`,"g"),"ik-corr-sugg-succ"):e.replace(new RegExp(`>${i}</span><ul>`,"g"),` data-orig="${a}">${i}</span><ul><li class="ik-act-rev">[cofnij korektę]</li>`)}return e},$=function(e,t){for(var r=0;r<t.length;r++)e=e.replace(C(t[r]),`$1<span class="ik-mark"><span data-corr="$2" class="ik-corr ik-corr-fail">$2</span><ul>${z()}</ul></span>`);return e},E=function(e,t){if(e.splice(e.indexOf(t),1),t.indexOf("rz")>-1){var r=e.indexOf(t.replace("rz","z"));r>-1&&e.splice(r,1)}return e},C=function(e,t){return new RegExp(`(\\s|[„(/,:;]|-|^)(${e})(?=\\s|[.?!,…:;"”()/<]|-|$)`,"g"+(t||""))},z=function(){return'<li class="ik-act-edit">[edytuj]</li><li class="ik-act-rest ik-dis">[przywróć]</li>'},S=function(e){var t=e.parentNode.previousSibling;e.classList.contains("ik-act-rev")?j(t,e):e.classList.contains("ik-act-edit")?O(t):e.classList.contains("ik-act-rest")?I(t,e):A(t,e)},j=function(e,t){e.textContent=e.getAttribute("data-orig"),e.classList.add("ik-corr-rev"),e.classList.remove("ik-corr-user"),t.classList.add("ik-dis"),t.parentNode.querySelector(".ik-act-rest").classList.remove("ik-dis")},O=function(e){var t=document.createRange(),r=window.getSelection();e.setAttribute("contenteditable",!0),t.setStart(e.childNodes[0],e.textContent.length),t.collapse(!0),r.removeAllRanges(),r.addRange(t)},T=function(e){var t=e.nextSibling,r=e.textContent,n=r===e.getAttribute("data-orig"),i=r===e.getAttribute("data-corr");e.setAttribute("contenteditable",!1),e.classList.toggle("ik-corr-user",!i&&!n),e.classList.toggle("ik-corr-rev",n),t.querySelector(".ik-act-rest").classList.toggle("ik-dis",i),t.querySelector(".ik-act-edit").classList.toggle("ik-dis",""===r);var a=t.querySelector(".ik-act-rev");a&&a.classList.toggle("ik-dis",!i),q(t,r),e.blur()},A=function(e,t){var r=t.textContent,n=t.parentNode;e.textContent.match(/^[A-ZŻŹŁĆŚÓ]/)&&(r=r.charAt(0).toUpperCase()+r.substr(1)),e.textContent=r,e.classList.add("ik-corr-user"),e.classList.remove("ik-corr-rev"),q(n),t.classList.add("ik-dis"),n.querySelector(".ik-act-rest").classList.remove("ik-dis"),n.querySelector(".ik-act-edit").classList.remove("ik-dis");var i=n.querySelector(".ik-act-rev");i&&i.classList.add("ik-dis")},I=function(e,t){var r=e.getAttribute("data-corr"),n=t.parentNode;e.textContent=r,e.classList.remove("ik-corr-user","ik-corr-rev"),t.classList.add("ik-dis"),q(n),n.querySelector(".ik-act-edit").classList.remove("ik-dis");var i=n.querySelector(".ik-act-rev");i&&i.classList.remove("ik-dis")},q=function(e,t=null){[].forEach.call(e.getElementsByClassName("ik-sugg"),e=>{e.classList.toggle("ik-dis",t&&t.toLowerCase()===e.textContent)})},B=function(t){var r=H(t.querySelector("div").innerHTML);N(P(r)),t.style.display="none",document.getElementById("ik-do").disabled=!1,e.focus()},N=function(r){var n=e.selectionStart,i=e.selectionEnd;e.value=n===i?r:e.value.substr(0,n)+t.match(/^\s*/)+r+t.match(/\s*$/)+e.value.substr(i)},R=function(e){return e.replace("ó","o").replace("ł","l").replace("ą","a").replace("ę","e").replace("ś","s").replace("ń","n").replace("ć","c").replace("ż","z").replace("ź","z")},H=function(e){return e.replace(/<ul>.*?<\/ul>|<\/?span.*?>/g,"")},P=function(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return e.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,e=>t[e])},M=function(e,t){return`<button type="button" id="${t}">${e}</button>`},K=function(e,t,r=null){return`<a href="${"https://ikorektor.pl/"+e}" target="_blank" rel="noopener"${r?' id="'+r+'"':""}>${t}</a>`},_=function(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}},D=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}};iKorektor.init(document.getElementsByTagName("textarea").length||document.querySelector("input[type=text]"));
