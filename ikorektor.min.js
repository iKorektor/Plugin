var iKorektor=new function(){var e,t,r,n='<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ikorektor/plugin@2/css/style.min.css">',i={location:"bottom",inputs:!0,prompt:!1,parags:0,profanity:0,gateway:!0,version:null,csshash:null};this.init=function(e){"object"==typeof iKorektorConf&&(i=Object.assign(i,iKorektorConf)),i.version&&i.csshash&&(n=n.replace("@2","@"+i.version).replace(">",` integrity="${i.csshash}" crossorigin="anonymous">`)),e&&document.addEventListener("click",a)};var a=function(n){var a=n.target;if(a){var u=a.tagName.toLowerCase();if("textarea"===u||i.inputs&&"input"===u&&"text"===a.type)e!==a&&(r=null),e=a,o();else if("li"===u)a.className.indexOf("ik-")>=0&&!a.classList.contains("ik-dis")&&C(a);else if(i.prompt&&"submit"===a.type)s(n);else switch(a.id){case"ik-do":l();break;case"ik-accept":A(a.parentNode);break;case"ik-cancel":a.parentNode.style.display="none",document.getElementById("ik-do").disabled=!1,e.focus();break;case"ik-report":n.preventDefault(),window.open(a.href+(t?"="+encodeURIComponent(t):""));break;default:c()}}},s=function(t){var r=document.getElementsByTagName("textarea");if(r){e=null;for(var n=0;n<r.length;n++)if(r[n].value.length>2){e=r[n];break}e&&(i.prompt=!1,confirm("Czy chcesz wykonać autokorektę tekstu przed wysłaniem?")&&(t.preventDefault(),o(),l(),e.scrollIntoView({behavior:"smooth"})))}},o=function(){var t=document.getElementById("ik-do");if(!t)return document.body.insertAdjacentHTML("beforeend",R("","ik-do")+n),setTimeout(o,500);t.style.display="block";var r=M(e),a="top"===i.location?r.top+5:r.top+e.offsetHeight-t.offsetHeight-5,s=window.innerWidth-(r.left+e.offsetWidth);t.style.top=a.toFixed(2)+"px",t.style.right=s.toFixed(2)+"px",t.disabled=!1;var c=document.getElementById("ik-inf");c&&(c.style.display="none")},c=function(){var t=document.getElementById("ik-do");if(t&&K(t)){var r=document.getElementById("ik-inf"),n=window.innerWidth>720&&(!r||!K(r)),i=window.innerWidth<721&&!K(e);(n||i)&&(t.style.display="none")}},l=function(){var e=p();if(e.length<3)return k("Tekst jest zbyt krótki.",!0);var t=document.getElementById("ik-do");t.disabled=!0,t.classList.add("ik-spin"),u(e)},u=function(n){fetch("https://api.ikorektor.pl",{method:"POST",body:d(n),credentials:"include"}).then(e=>{if(e.ok)return e.json();throw Error(e.statusText)}).then(a=>{if(a.hasOwnProperty("error"))k(f(a,n.length),!0);else{t=n,r=e.value,i.prompt=!1;var s=document.createElement("p");s.textContent=a.text,a.text=s.innerHTML,k(m(a),!1)}}).catch(e=>{console.log(e),k(f({},null),!0)})},d=function(e){var t=new FormData;return t.append("key","O"),t.append("text",e),t.append("app","plugin"),i.parags&&t.append("parags",i.parags),i.profanity&&t.append("profanity",i.profanity),i.gateway||t.append("gateway",0),t},p=function(){var t=e.selectionStart,r=e.selectionEnd;return t===r?e.value.trim():e.value.slice(t,r)},k=function(e,t){var r=document.getElementById("ik-inf");if(!r)return document.body.insertAdjacentHTML("beforeend",`<div id="ik-inf"><div></div>${R("Anuluj","ik-cancel")+R("Akceptuj i zamień","ik-accept")}\n<p>${H("pluginy","Plugin autokorekty © iKorektor")+"•"+H("info","Informacje")+"•"+H("kontakt?report","Zgłoś błąd korekty","ik-report")}</p></div>`),g(),k(e,t);var n=document.getElementById("ik-do"),i=r.querySelector("div");n.disabled=!t,n.classList.remove("ik-spin"),r.style.top=parseInt(n.style.top,10)+n.offsetHeight+9+"px",r.style.right=n.style.right,r.style.display="block",i.innerHTML=e,i.classList.toggle("ik-corr-err",t),r.querySelector("#ik-accept").disabled=t},g=function(){document.addEventListener("keydown",t=>{var n=t.target;13===t.keyCode&&n&&n.classList.contains("ik-corr")?S(n):90===t.keyCode&&t.ctrlKey&&r&&(e.value=r,r=null)}),document.addEventListener("focusout",e=>{var t=e.target;t&&t.classList.contains("ik-corr")&&S(t)})},f=function(e,t){switch(e.error){case"TXT_LEN":return`Tekst jest zbyt długi (${t} na ${e.txt_limit} dozwolonych znaków w jednej korekcie).`;case"CHARS_LMT":return`Pozostało Ci ${e.chars_left} znaków z dobowego limitu, tekst ma ${t} znaków.`;case"CALLS_LMT":return"Osiągnięto limit korekt na minutę. Spróbuj ponownie za chwilę.";case"SITE_LMT":return"Dobowy limit użycia pluginu został osiągnięty. Tekst możesz poprawić na stronie "+H("","iKorektor.pl")}return"Coś poszło nie tak. Spróbuj ponownie za chwilę lub "+H("info","dowiedz się więcej")},m=function(e){var t=e.text,r=t.match(/[a-zA-ZŻŹŁŚĆÓąęćłóśńżź]{2,}/g),n=t.match(/.{4}[,.)”–?]|[(„].{4}/g),i=[];return n&&(t=v(t,n)),e.hasOwnProperty("sugg")&&(t=y(t,e.sugg,i)),r&&(t=h(t,r)),e.hasOwnProperty("succ")&&(t=w(t,e.succ,i)),e.hasOwnProperty("fail")&&(t=b(t,e.fail)),t},v=function(e,r){for(var n=0;n<r.length;n++)-1===t.indexOf(r[n])&&-1===t.indexOf(I(r[n].toLowerCase()))&&(e=e.replace(r[n],r[n].replace(/([,.()„”–?])/g,`<span class="ik-mark"><span data-corr="$1" class="ik-corr ik-corr-succ">$1</span><ul>${$()}</ul></span>`)));return e},y=function(e,t,r){for(var n=0;n<t.length;n++){var i=t[n],a=i.length-1,s=i[a],o=s.toLowerCase(),c="";(i=i.slice(0,a)).indexOf(o)<0&&i.indexOf(s.substr(0,1).toUpperCase()+o.substr(1))<0?c="2":i=L(i,o);var l=i.length?`<li class="ik-sugg">${i.join('</li><li class="ik-sugg">')}</li>`:"";e=e.replace(x(s,"i"),`$1<span class="ik-mark"><span data-corr="$2" class="ik-corr ik-corr-sugg${c}">$2</span><ul>${l+$()}</ul></span>`),r[n]=s}return e},h=function(e,r){for(var n=0;n<r.length;n++){var i=r[n],a=x(i);t.match(a)||(e=(e=e.replace(a,`$1<span class="ik-mark"><span data-corr="$2" class="ik-corr ik-corr-succ">$2</span><ul>${$()}</ul></span>`)).replace(new RegExp(`ik-corr-sugg(2?)(?=">${i})`,"g"),"ik-corr-sugg$1-succ"))}return e},w=function(e,t,r){for(var n=0;n<t.length;n++){var i=t[n][0],a=t[n][1];e=r.indexOf(a)>=0?e.replace(new RegExp(`ik-corr-sugg(?=">${i})`,"g"),"ik-corr-sugg-succ"):e.replace(new RegExp(`>${i}</span><ul>`,"g"),` data-orig="${a}">${i}</span><ul><li class="ik-act-rev">[cofnij korektę]</li>`)}return e},b=function(e,t){for(var r=0;r<t.length;r++)e=e.replace(x(t[r]),`$1<span class="ik-mark"><span data-corr="$2" class="ik-corr ik-corr-fail">$2</span><ul>${$()}</ul></span>`);return e},L=function(e,t){if(e.splice(e.indexOf(t),1),t.indexOf("rz")>-1){var r=e.indexOf(t.replace("rz","z"));r>-1&&e.splice(r,1)}return e},x=function(e,t){return new RegExp(`(\\s|[„(/,:;]|-|^)(${e})(?=\\s|[.?!,…:;"”()/<]|-|$)`,"g"+(t||""))},$=function(){return'<li class="ik-act-edit">[edytuj]</li><li class="ik-act-rest ik-dis">[przywróć]</li>'},C=function(e){var t=e.parentNode.previousSibling;e.classList.contains("ik-act-rev")?E(t,e):e.classList.contains("ik-act-edit")?z(t):e.classList.contains("ik-act-rest")?j(t,e):T(t,e)},E=function(e,t){e.textContent=e.getAttribute("data-orig"),e.classList.add("ik-corr-rev"),e.classList.remove("ik-corr-user"),t.classList.add("ik-dis"),t.parentNode.querySelector(".ik-act-rest").classList.remove("ik-dis")},z=function(e){var t=document.createRange(),r=window.getSelection();e.setAttribute("contenteditable",!0),t.setStart(e.childNodes[0],e.textContent.length),t.collapse(!0),r.removeAllRanges(),r.addRange(t)},S=function(e){var t=e.nextSibling,r=e.textContent,n=r===e.getAttribute("data-orig"),i=r===e.getAttribute("data-corr");e.setAttribute("contenteditable",!1),e.classList.toggle("ik-corr-user",!i&&!n),e.classList.toggle("ik-corr-rev",n),t.querySelector(".ik-act-rest").classList.toggle("ik-dis",i),t.querySelector(".ik-act-edit").classList.toggle("ik-dis",""===r);var a=t.querySelector(".ik-act-rev");a&&a.classList.toggle("ik-dis",!i),O(t,r),e.blur()},T=function(e,t){var r=t.textContent,n=t.parentNode;e.textContent.match(/^[A-ZŻŹŁĆŚÓ]/)&&(r=r.charAt(0).toUpperCase()+r.substr(1)),e.textContent=r,e.classList.add("ik-corr-user"),e.classList.remove("ik-corr-rev"),O(n),t.classList.add("ik-dis"),n.querySelector(".ik-act-rest").classList.remove("ik-dis"),n.querySelector(".ik-act-edit").classList.remove("ik-dis");var i=n.querySelector(".ik-act-rev");i&&i.classList.add("ik-dis")},j=function(e,t){var r=e.getAttribute("data-corr"),n=t.parentNode;e.textContent=r,e.classList.remove("ik-corr-user","ik-corr-rev"),t.classList.add("ik-dis"),O(n),n.querySelector(".ik-act-edit").classList.remove("ik-dis");var i=n.querySelector(".ik-act-rev");i&&i.classList.remove("ik-dis")},O=function(e,t=null){[].forEach.call(e.getElementsByClassName("ik-sugg"),e=>{e.classList.toggle("ik-dis",t&&t.toLowerCase()===e.textContent)})},A=function(t){var r=B(t.querySelector("div").innerHTML);q(N(r)),t.style.display="none",document.getElementById("ik-do").disabled=!1,e.focus()},q=function(r){var n=e.selectionStart,i=e.selectionEnd;e.value=n===i?r:e.value.substr(0,n)+t.match(/^\s*/)+r+t.match(/\s*$/)+e.value.substr(i)},I=function(e){return e.replace("ó","o").replace("ł","l").replace("ą","a").replace("ę","e").replace("ś","s").replace("ń","n").replace("ć","c").replace("ż","z").replace("ź","z")},B=function(e){return e.replace(/<ul>.*?<\/ul>|<\/?span.*?>/g,"")},N=function(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return e.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,e=>t[e])},R=function(e,t){return`<button type="button" id="${t}">${e}</button>`},H=function(e,t,r=null){return`<a href="${"https://ikorektor.pl/"+e}" target="_blank" rel="noopener"${r?' id="'+r+'"':""}>${t}</a>`},M=function(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}},K=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}};iKorektor.init(document.getElementsByTagName("textarea").length||document.querySelector("input[type=text]"));
