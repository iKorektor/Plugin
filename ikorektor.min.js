var iKorektor=new function(){var e,t,r,n={location:"bottom",inputs:!0,prompt:!1,parags:0,profanity:0,gateway:!0};this.init=function(e){"object"==typeof iKorektorConf&&(n=Object.assign(n,iKorektorConf)),e&&document.addEventListener("click",i)};var i=function(i){var l=i.target;if(l){var u=l.tagName.toLowerCase();if("textarea"===u||n.inputs&&"input"===u&&"text"===l.type)e!==l&&(r=null),e=l,o();else if("li"===u)l.className.indexOf("ik-")>=0&&!l.classList.contains("ik-dis")&&$(l);else if(n.prompt&&"submit"===l.type)a(i);else switch(l.id){case"ik-do":c();break;case"ik-accept":O(l.parentNode);break;case"ik-cancel":l.parentNode.style.display="none",document.getElementById("ik-do").disabled=!1,e.focus();break;case"ik-report":i.preventDefault(),window.open(l.href+(t?"="+encodeURIComponent(t):""));break;default:s()}}},a=function(t){var r=document.getElementsByTagName("textarea");if(r){e=null;for(var i=0;i<r.length;i++)if(r[i].value.length>2){e=r[i];break}e&&(n.prompt=!1,confirm("Czy chcesz wykonać autokorektę tekstu przed wysłaniem?")&&(t.preventDefault(),o(),c(),e.scrollIntoView({behavior:"smooth"})))}},o=function(){var t=document.getElementById("ik-do");if(!t)return document.body.insertAdjacentHTML("beforeend",N("","ik-do")+'<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ikorektor/plugin@2.0.0/css/style.min.css" integrity="sha384-G3dOApykiTPL7aLeEbzVHXwUSk1JTWV52G674xzrN19aPDVo7YHmxRvZfI1+n9RG" crossorigin="anonymous">'),setTimeout(o,500);t.style.display="block";var r=H(e),i="top"===n.location?r.top+5:r.top+e.offsetHeight-t.offsetHeight-5,a=window.innerWidth-(r.left+e.offsetWidth);t.style.top=i.toFixed(2)+"px",t.style.right=a.toFixed(2)+"px",t.disabled=!1;var s=document.getElementById("ik-inf");s&&(s.style.display="none")},s=function(){var t=document.getElementById("ik-do");if(t&&K(t)){var r=document.getElementById("ik-inf"),n=window.innerWidth>720&&(!r||!K(r)),i=window.innerWidth<721&&!K(e);(n||i)&&(t.style.display="none")}},c=function(){var e=d();if(e.length<3)return p("Tekst jest zbyt krótki.",!0);var t=document.getElementById("ik-do");t.disabled=!0,t.classList.add("ik-spin"),l(e)},l=function(i){fetch("https://api.ikorektor.pl",{method:"POST",body:u(i),credentials:"include"}).then(e=>{if(e.ok)return e.json();throw Error(e.statusText)}).then(a=>{if(a.hasOwnProperty("error"))p(g(a,i.length),!0);else{t=i,r=e.value,n.prompt=!1;var o=document.createElement("p");o.textContent=a.text,a.text=o.innerHTML,p(f(a),!1)}}).catch(e=>{console.log(e),p(g({},null),!0)})},u=function(e){var t=new FormData;return t.append("key","O"),t.append("text",e),t.append("app","plugin"),n.parags&&t.append("parags",n.parags),n.profanity&&t.append("profanity",n.profanity),n.gateway||t.append("gateway",0),t},d=function(){var t=e.selectionStart,r=e.selectionEnd;return t===r?e.value.trim():e.value.slice(t,r)},p=function(e,t){var r=document.getElementById("ik-inf");if(!r)return document.body.insertAdjacentHTML("beforeend",`<div id="ik-inf"><div></div>${N("Anuluj","ik-cancel")+N("Akceptuj i zamień","ik-accept")}\n<p>${R("pluginy","Plugin autokorekty © iKorektor")+"•"+R("info","Informacje")+"•"+R("kontakt?report","Zgłoś błąd korekty","ik-report")}</p></div>`),k(),p(e,t);var n=document.getElementById("ik-do"),i=r.querySelector("div");n.disabled=!t,n.classList.remove("ik-spin"),r.style.top=parseInt(n.style.top,10)+n.offsetHeight+9+"px",r.style.right=n.style.right,r.style.display="block",i.innerHTML=e,i.classList.toggle("ik-corr-err",t),r.querySelector("#ik-accept").disabled=t},k=function(){document.addEventListener("keydown",t=>{var n=t.target;13===t.keyCode&&n&&n.classList.contains("ik-corr")?E(n):90===t.keyCode&&t.ctrlKey&&r&&(e.value=r,r=null)}),document.addEventListener("focusout",e=>{var t=e.target;t&&t.classList.contains("ik-corr")&&E(t)})},g=function(e,t){switch(e.error){case"TXT_LEN":return`Tekst jest zbyt długi (${t} na ${e.txt_limit} dozwolonych znaków w jednej korekcie).`;case"CHARS_LMT":return`Pozostało Ci ${e.chars_left} znaków z dobowego limitu, tekst ma ${t} znaków.`;case"CALLS_LMT":return"Osiągnięto limit korekt na minutę. Spróbuj ponownie za chwilę.";case"SITE_LMT":return"Dobowy limit użycia pluginu został osiągnięty. Tekst możesz poprawić na stronie "+R("","iKorektor.pl")}return"Coś poszło nie tak. Spróbuj ponownie za chwilę lub "+R("info","dowiedz się więcej")},f=function(e){var t=e.text,r=t.match(/[a-zA-ZŻŹŁŚĆÓąęćłóśńżź]{2,}/g),n=t.match(/.{4}[,.)”–?]|[(„].{4}/g),i=[];return n&&(t=m(t,n)),e.hasOwnProperty("sugg")&&(t=v(t,e.sugg,i)),r&&(t=y(t,r)),e.hasOwnProperty("succ")&&(t=h(t,e.succ,i)),e.hasOwnProperty("fail")&&(t=b(t,e.fail)),t},m=function(e,r){for(var n=0;n<r.length;n++)-1===t.indexOf(r[n])&&-1===t.indexOf(q(r[n].toLowerCase()))&&(e=e.replace(r[n],r[n].replace(/([,.()„”–?])/g,`<span class="ik-mark"><span data-corr="$1" class="ik-corr ik-corr-succ">$1</span><ul>${x()}</ul></span>`)));return e},v=function(e,t,r){for(var n=0;n<t.length;n++){var i=t[n],a=i.length-1,o=i[a],s=o.toLowerCase(),c="";(i=i.slice(0,a)).indexOf(s)<0&&i.indexOf(o.substr(0,1).toUpperCase()+s.substr(1))<0?c="2":i=w(i,s);var l=i.length?`<li class="ik-sugg">${i.join('</li><li class="ik-sugg">')}</li>`:"";e=e.replace(L(o,"i"),`$1<span class="ik-mark"><span data-corr="$2" class="ik-corr ik-corr-sugg${c}">$2</span><ul>${l+x()}</ul></span>`),r[n]=o}return e},y=function(e,r){for(var n=0;n<r.length;n++){var i=r[n],a=L(i);t.match(a)||(e=(e=e.replace(a,`$1<span class="ik-mark"><span data-corr="$2" class="ik-corr ik-corr-succ">$2</span><ul>${x()}</ul></span>`)).replace(new RegExp(`ik-corr-sugg(2?)(?=">${i})`,"g"),"ik-corr-sugg$1-succ"))}return e},h=function(e,t,r){for(var n=0;n<t.length;n++){var i=t[n][0],a=t[n][1];e=r.indexOf(a)>=0?e.replace(new RegExp(`ik-corr-sugg(?=">${i})`,"g"),"ik-corr-sugg-succ"):e.replace(new RegExp(`>${i}</span><ul>`,"g"),` data-orig="${a}">${i}</span><ul><li class="ik-act-rev">[cofnij korektę]</li>`)}return e},b=function(e,t){for(var r=0;r<t.length;r++)e=e.replace(L(t[r]),`$1<span class="ik-mark"><span data-corr="$2" class="ik-corr ik-corr-fail">$2</span><ul>${x()}</ul></span>`);return e},w=function(e,t){if(e.splice(e.indexOf(t),1),t.indexOf("rz")>-1){var r=e.indexOf(t.replace("rz","z"));r>-1&&e.splice(r,1)}return e},L=function(e,t){return new RegExp(`(\\s|[„(/,:;]|-|^)(${e})(?=\\s|[.?!,…:;"”()/<]|-|$)`,"g"+(t||""))},x=function(){return'<li class="ik-act-edit">[edytuj]</li><li class="ik-act-rest ik-dis">[przywróć]</li>'},$=function(e){var t=e.parentNode.previousSibling;e.classList.contains("ik-act-rev")?z(t,e):e.classList.contains("ik-act-edit")?C(t):e.classList.contains("ik-act-rest")?T(t,e):S(t,e)},z=function(e,t){e.textContent=e.getAttribute("data-orig"),e.classList.add("ik-corr-rev"),e.classList.remove("ik-corr-user"),t.classList.add("ik-dis"),t.parentNode.querySelector(".ik-act-rest").classList.remove("ik-dis")},C=function(e){var t=document.createRange(),r=window.getSelection();e.setAttribute("contenteditable",!0),t.setStart(e.childNodes[0],e.textContent.length),t.collapse(!0),r.removeAllRanges(),r.addRange(t)},E=function(e){var t=e.nextSibling,r=e.textContent,n=r===e.getAttribute("data-orig"),i=r===e.getAttribute("data-corr");e.setAttribute("contenteditable",!1),e.classList.toggle("ik-corr-user",!i&&!n),e.classList.toggle("ik-corr-rev",n),t.querySelector(".ik-act-rest").classList.toggle("ik-dis",i),t.querySelector(".ik-act-edit").classList.toggle("ik-dis",""===r);var a=t.querySelector(".ik-act-rev");a&&a.classList.toggle("ik-dis",!i),j(t,r),e.blur()},S=function(e,t){var r=t.textContent,n=t.parentNode;e.textContent.match(/^[A-ZŻŹŁĆŚÓ]/)&&(r=r.charAt(0).toUpperCase()+r.substr(1)),e.textContent=r,e.classList.add("ik-corr-user"),e.classList.remove("ik-corr-rev"),j(n),t.classList.add("ik-dis"),n.querySelector(".ik-act-rest").classList.remove("ik-dis"),n.querySelector(".ik-act-edit").classList.remove("ik-dis");var i=n.querySelector(".ik-act-rev");i&&i.classList.add("ik-dis")},T=function(e,t){var r=e.getAttribute("data-corr"),n=t.parentNode;e.textContent=r,e.classList.remove("ik-corr-user","ik-corr-rev"),t.classList.add("ik-dis"),j(n),n.querySelector(".ik-act-edit").classList.remove("ik-dis");var i=n.querySelector(".ik-act-rev");i&&i.classList.remove("ik-dis")},j=function(e,t=null){[].forEach.call(e.getElementsByClassName("ik-sugg"),e=>{e.classList.toggle("ik-dis",t&&t.toLowerCase()===e.textContent)})},O=function(t){var r=B(t.querySelector("div").innerHTML);A(I(r)),t.style.display="none",document.getElementById("ik-do").disabled=!1,e.focus()},A=function(r){var n=e.selectionStart,i=e.selectionEnd;e.value=n===i?r:e.value.substr(0,n)+t.match(/^\s*/)+r+t.match(/\s*$/)+e.value.substr(i)},q=function(e){return e.replace("ó","o").replace("ł","l").replace("ą","a").replace("ę","e").replace("ś","s").replace("ń","n").replace("ć","c").replace("ż","z").replace("ź","z")},B=function(e){return e.replace(/<ul>.*?<\/ul>|<\/?span.*?>/g,"")},I=function(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return e.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,e=>t[e])},N=function(e,t){return`<button type="button" id="${t}">${e}</button>`},R=function(e,t,r=null){return`<a href="${"https://ikorektor.pl/"+e}" target="_blank" rel="noopener"${r?' id="'+r+'"':""}>${t}</a>`},H=function(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}},K=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}};iKorektor.init(document.getElementsByTagName("textarea").length||document.querySelector("input[type=text]"));
